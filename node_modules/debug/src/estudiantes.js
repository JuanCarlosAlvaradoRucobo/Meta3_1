// estudiantes.js

const fs = require('fs');
const path = require('path');

const filePath = path.join(__dirname, 'estudiantes.json');

// Función para leer los estudiantes del archivo JSON
const readEstudiantes = () => {
    const data = fs.readFileSync(filePath);
    return JSON.parse(data);
};

// Función para escribir los estudiantes en el archivo JSON
const writeEstudiantes = (data) => {
    fs.writeFileSync(filePath, JSON.stringify(data, null, 2));
};

const findById = function (id) {
    const estudiantes = readEstudiantes();
    return estudiantes.find((e) => e.id == id);
};

const findByMatricula = function (matricula) {
    const estudiantes = readEstudiantes();
    return estudiantes.find((e) => e.matricula == matricula);
};

const findAll = function() {
    return readEstudiantes();
};

const save = function (id, data) {
    const estudiantes = readEstudiantes();
    let registro = estudiantes.find((e) => e.id == id);
    if (registro) {
        for (let [key, value] of Object.entries(data)) {
            registro[key] = value;
        }
    } else {
        // Si no se encuentra, se agrega un nuevo estudiante
        const nuevoEstudiante = { id, ...data };
        estudiantes.push(nuevoEstudiante);
    }
    writeEstudiantes(estudiantes);
    return registro || data; // Retorna el registro actualizado o el nuevo
};

module.exports = {
    findById,
    findByMatricula,
    findAll,
    save
};
